# 섹션 13. 교착 상태

## 교착 상태란

### 식사하는 철학자 문제

![image.png](%E1%84%89%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A7%E1%86%AB%2013%20%E1%84%80%E1%85%AD%E1%84%8E%E1%85%A1%E1%86%A8%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%20971d789d3be04c08b2ce83d29eab6067/image.png)

→ 위 조건을 모두 만족하게 식사가 불가능!

: 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상

![게임과 웹브라우저 모두 자원 A, B 다 필요하다고 가정 → 교착 상태](%E1%84%89%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A7%E1%86%AB%2013%20%E1%84%80%E1%85%AD%E1%84%8E%E1%85%A1%E1%86%A8%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%20971d789d3be04c08b2ce83d29eab6067/image%201.png)

게임과 웹브라우저 모두 자원 A, B 다 필요하다고 가정 → 교착 상태

### 교착상태 해결을 위한 사고

1. 교착 상태가 발생했을 때의 상황 정확히 파악
2. 근본적 이유 파악

### 자원 할당 그래프

교착 상태 발생 조건 파악 가능

- 어떤 프로세스가 어떤 자원을 할당 받아 사용 중인지
- 어떤 프로세스가 어떤 자원을 기다리고 있는지
- 프로세스는 원으로, 자원의 종류는 사각형으로
- 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현
- 프로세스가 어떤 자원을 할당 받아 사용 중이라면 자원에서 프로세스를 향해 화살표 표시
- 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표 표시

![자원할당 그래프의 예시](%E1%84%89%E1%85%A6%E1%86%A8%E1%84%89%E1%85%A7%E1%86%AB%2013%20%E1%84%80%E1%85%AD%E1%84%8E%E1%85%A1%E1%86%A8%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%20971d789d3be04c08b2ce83d29eab6067/image%202.png)

자원할당 그래프의 예시

- 교착 상태 → 자원 할당 그래프가 **원**을 그림(역은 만족 X)

### 교착 상태 발생 조건

- 상호 배제
    - 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 상태
- 점유와 대기
    - 자원을 할당 받은 상태에서 다른 자원을 할당 받기를 기다리는 상태
- 비선점
    - 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 상태
- 원형 대기
    - 프로세스들이 원의 형태로 자원을 대기하는 상태

위 조건을 모두 만족할 때 교착 상태 발생 가능!

하나라도 불만족이면 교착 상태 발생 안 함 

## 교착 상태 해결 방법

### 교착 상태 해결

- 예방
- 회피
- 검출 후 회복

### 예방

- 애초에 교착 상태가 발생하지 않도록 함
- 교착 상태 발생 조건 중 하나를 제거
    - **상호 배제 제거**: 모든 자원 공유 가능하게 변경 → 현실적으로 불가능
    - **점유와 대기 제거**: 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분 → 자원의 활용률을 낮출 수 있는 방식
    - **비선점 조건 제거**: 선점이 가능한 자원(CPU)에 한해 효과적 → 모든 자원이 선점 가능하지는 않음
    - **원형 대기 제거**: 모든 자원에 번호를 붙이고 오름차순으로 할당 → 가장 실용적인 방안 BUT, 모든 자원에 번호 붙이기는 어려운 작업 & 어떤 자원에 어떤 번호를 붙이느냐에 따른 활용률 차이
- 확실한 보장 하지만 부작용 존재

### 회피

- 교착 상태를 **무분별한 자원 할당으로 인해 발생**했다고 간주
- 교착 상태가 발생하지 않을 만큼만 조심해서 할당하기
- 배분할 수 있는 자원의 양을 고려하여 교착 상태가 발생하지 않을 만큼만 배분
- 안전 상태에서 안전 상태로 움직이는 경우에만 자원 할당!
- **안전 순서열**: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서열
- **안전 상태**: 교착 상태 없이 모든 프로세스가 자원을 할당 받고 종료될 수 있는 상태 / 안전 순서열이 있는 상태
- **불안전 상태**: 교착 상태가 발생할 수 있는 상태
- **은행원 알고리즘**이 대표적인 회피 알고리즘

### 검출 후 회복

- 발생을 인정 후 사후 조치
- **선점을 통한 회복**
- **프로세스 강제 종료를 통한 회복**

### 교착 상태 무시

- **타조 알고리즘**
    - 대부분의 운영체제가 선택